(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-780cbbec"],{"2a41":function(t,a,e){"use strict";e.r(a);var s=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"d-flex flex-grow-1 p-0"},[e("div",{staticClass:"d-flex flex-column flex-grow-1 bg-white"},[e("div",{staticClass:"flex-wrap align-items-center flex-grow-1 position-relative bg-gray-50"},[e("div",{staticClass:"position-absolute pos-top pos-bottom w-100 custom-scroll"},[e("div",{staticClass:"d-flex h-100 flex-column"},[e("div",{staticClass:"d-flex align-items-center pl-2 pr-3 py-3 pl-sm-3 pr-sm-4 py-sm-4 px-lg-3 py-lg-3 flex-shrink-0 bg-white"},[e("h1",{staticClass:"subheader-title fs-md mb-0 mt-1 ml-3 text-black-50 fw-900"},[t._v(t._s(t.task.name))]),e("small",{style:{visibility:t.task.dueDate?"visible":"hidden"}},[e("i",{staticClass:"far fa-fw fa-alarm-exclamation mr-2"}),t._v(" "+t._s(t.moment(t.task.dueDate).format("YYYY-MM-DD HH:mm"))+" ")])]),t._l(t.formData,(function(a,s){return e("div",{key:a.id,staticClass:"d-flex flex-column border-faded border-top-0 border-left-0 border-right-0 py-3 px-3 px-sm-4 px-lg-0 mr-0 mr-lg-5 flex-shrink-0",attrs:{id:"legend"+a.id}},[e("div",{staticClass:"d-flex align-items-center flex-row"},[e("div",{staticClass:"ml-0 mr-3 mx-lg-4"},[e("i",{staticClass:"fad fa-2x fa-fw",class:{"fa-question-square":!a.complete,"text-default":!a.complete,"fa-check":!!a.complete,"text-success":!!a.complete}})]),e("div",{staticClass:"fw-500 flex-1 d-flex flex-column cursor-pointer",attrs:{"data-toggle":"collapse","data-target":"#legend"+a.id+" > .js-collapse"}},[e("div",{staticClass:"fs-sm"},[e("span",{staticClass:"fw-900 color-black"},[t._v(t._s(a.legend))])])]),e("div",{staticClass:"color-fusion-200 fs-sm",staticStyle:{"text-align":"right"}},[e("span",{staticClass:"text-primary"},[e("strong",[t._v(t._s(s+1))])])])]),e("div",{staticClass:"collapse js-collapse"},[e("div",{staticClass:"pl-lg-5 ml-lg-5 pt-3 pb-4 mt-0"},[e("div",{staticClass:"row color-black panel-tag ml-0 mt-0 mb-0 fs-sm"},[e("div",{staticClass:"col-12 mb-2"},t._l(a.components,(function(t){return e("field",{key:t.id,attrs:{data:t},on:{"update:data":function(a){t=a}}})})),1),t._m(0,!0),e("div",{staticClass:"col-6 mt-2"},[e("a",{staticClass:"btn btn-default btn-sm btn-block fw-400",class:{disabled:0===s},attrs:{href:"javascript:void(0);"},on:{click:function(a){return t.goStep(s,s-1)}}},[e("i",{staticClass:"fad fa-fw fa-angle-double-left mr-2"}),t._v("上一条 ")])]),e("div",{staticClass:"col-6 mt-2"},[e("a",{staticClass:"btn btn-default btn-sm btn-block fw-400",class:{disabled:s===t.formData.length-1},attrs:{href:"javascript:void(0);"},on:{click:function(a){return t.goStep(s,s+1)}}},[e("i",{staticClass:"fad fa-fw fa-angle-double-right mr-2"}),t._v("下一条 ")])])])])])])}))],2)])])])])},i=[function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"col-12 mb-2"},[e("div",{staticClass:"dropdown-divider"})])}],r=(e("99af"),e("4160"),e("d81d"),e("d3b7"),e("159b"),e("a49b"),e("90b9")),l=e("f523"),n=e("f817"),o=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"form-group"},["textfield"===t.data.type?e("div",[e("label",{staticClass:"form-label fw-400 text-black-50",attrs:{for:t.data.id}},[t._v(t._s(t.data.label))]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.data.value,expression:"data.value"}],staticClass:"form-control form-control-sm",class:{"is-invalid":t.data.invalid},attrs:{type:"text",id:t.data.id},domProps:{value:t.data.value},on:{input:function(a){a.target.composing||t.$set(t.data,"value",a.target.value)}}})]):t._e(),"textarea"===t.data.type?e("div",[e("label",{staticClass:"form-label fw-400 text-black-50",attrs:{for:t.data.id}},[t._v(t._s(t.data.label))]),e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.data.value,expression:"data.value"}],staticClass:"form-control",class:{"is-invalid":t.data.invalid},attrs:{id:t.data.id,rows:"3"},domProps:{value:t.data.value},on:{input:function(a){a.target.composing||t.$set(t.data,"value",a.target.value)}}})]):t._e(),"number"===t.data.type?e("div",[e("label",{staticClass:"form-label fw-400 text-black-50",attrs:{for:t.data.id}},[t._v(t._s(t.data.label))]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.data.value,expression:"data.value"}],staticClass:"form-control form-control-sm",class:{"is-invalid":t.data.invalid},attrs:{type:"number",id:t.data.id},domProps:{value:t.data.value},on:{input:function(a){a.target.composing||t.$set(t.data,"value",a.target.value)}}})]):t._e(),"date"===t.data.type?e("div",[e("label",{staticClass:"form-label fw-400 text-black-50",attrs:{for:t.data.id}},[t._v(t._s(t.data.label))]),e("input",{directives:[{name:"model",rawName:"v-model",value:t.data.value,expression:"data.value"}],staticClass:"form-control form-control-sm",class:{"is-invalid":t.data.invalid},attrs:{type:"date",id:t.data.id},domProps:{value:t.data.value},on:{input:function(a){a.target.composing||t.$set(t.data,"value",a.target.value)}}})]):t._e(),"radio"===t.data.type?e("div",[e("label",{staticClass:"form-label fw-400 text-black-50",attrs:{for:t.data.id}},[t._v(t._s(t.data.label))]),e("div",t._l(t.data.values,(function(a,s){return e("div",{key:s,staticClass:"custom-control custom-radio custom-control-inline",class:{"is-invalid":t.data.invalid}},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.data.value,expression:"data.value"}],staticClass:"custom-control-input",class:{"is-invalid":t.data.invalid},attrs:{type:"radio",id:t.data.id+s,name:t.data.id},domProps:{value:a.value,checked:t._q(t.data.value,a.value)},on:{change:function(e){return t.$set(t.data,"value",a.value)}}}),e("label",{staticClass:"custom-control-label",attrs:{for:t.data.id+s}},[t._v(t._s(a.label))])])})),0)]):t._e(),"file"===t.data.type?e("File",{attrs:{data:t.data},on:{"update:data":function(a){t.data=a}}}):t._e(),"select"===t.data.type?e("div",[e("label",{staticClass:"form-label fw-400 text-black-50",attrs:{for:t.data.id}},[t._v(t._s(t.data.label))]),e("select",{directives:[{name:"model",rawName:"v-model",value:t.data.value,expression:"data.value"}],staticClass:"form-control",class:{"is-invalid":t.data.invalid},attrs:{id:t.data.id,name:t.data.id},on:{change:function(a){var e=Array.prototype.filter.call(a.target.options,(function(t){return t.selected})).map((function(t){var a="_value"in t?t._value:t.value;return a}));t.$set(t.data,"value",a.target.multiple?e:e[0])}}},t._l(t.data.data.values,(function(a,s){return e("option",{key:s,domProps:{value:a.value}},[t._v(t._s(a.label))])})),0)]):t._e()],1)},d=[],c=function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",[e("label",{staticClass:"form-label fw-400 text-black-50",attrs:{for:t.data.id}},[t._v(t._s(t.data.label))]),e("div",{staticClass:"input-group"},[e("div",{staticClass:"custom-file"},[e("input",{staticClass:"custom-file-input",class:{"is-invalid":t.data.invalid},attrs:{type:"file",id:t.data.id,"aria-describedby":"btn"+t.data.id},on:{change:function(a){return t.changeFile(a)}}}),e("label",{staticClass:"custom-file-label",attrs:{for:t.data.id}},[t._v(t._s(t.name||"选择文件"))])]),e("div",{staticClass:"input-group-append"},[e("button",{staticClass:"btn btn-outline-default waves-effect waves-themed",class:{disabled:!t.name},attrs:{type:"button",id:"btn"+t.data.id},on:{click:function(a){return t.upload(a)}}},[t._v("上传")])])]),t._l(t.files,(function(a,s){return e("ul",{key:a.path,staticClass:"list-group shadow-sm"},[e("li",{staticClass:"list-group-item d-flex justify-content-between align-items-center"},[t._v(" "+t._s(a.name)+" "),e("a",{staticClass:"badge badge-danger badge-pill",attrs:{href:"javascript:void(0);"},on:{click:function(a){return t.removeFile(s)}}},[e("i",{staticClass:"far fa-fw fa-times mr-2"}),t._v("删除 ")])])])}))],2)},u=[],f=(e("7db0"),e("b0c0"),{data:function(){return r["a"].createModel({name:"",files:[]})},props:["data"],created:function(){var t=this;this.data.value||(this.data.value="[]");var a=JSON.parse(this.data.value);a.forEach((function(a){t.files.push(a)}))},mounted:function(){},methods:{changeFile:function(t){var a=t.target.files[0],e=a&&a.name||"";this.name=e},upload:function(t){var a=this,e=$(t.target).closest(".input-group").find("input"),s=e[0].files;if(s&&0!==s.length){var i=new FormData;i.append("fileUploaded",s[0]),i.append("user",this.user.id),i.append("id","lpa"),l["a"].upload(i).then((function(t){a.files.push(t.data),e.val(""),a.name="",a.data.value=JSON.stringify(a.files)}))}},removeFile:function(t){this.$delete(this.files,t),this.data.value=JSON.stringify(this.files)}}}),m=f,p=e("2877"),v=Object(p["a"])(m,c,u,!1,null,"3aeafd39",null),b=v.exports,h={name:"Field",data:function(){return{}},props:["data"],created:function(){},mounted:function(){},methods:{},components:{File:b}},g=h,y=Object(p["a"])(g,o,d,!1,null,"158c12fe",null),C=y.exports,x={data:function(){return r["a"].createModel({moment:n["a"],task:{},formData:[]})},created:function(){var t=this;this.user.id;l["a"].requestBpmn("runtime/tasks/"+this.$route.query.id).then((function(a){return t.task=a.data,t.task.formKey?l["a"].getItem("form",t.task.formKey):Promise.reject()})).then((function(a){a.data.formData.forEach((function(t){t.complete=!1,t.components.forEach((function(t){t.invalid=!1}))})),t.formData=a.data.formData,"desktop"===myapp_config.thisDevice&&$(".custom-scroll:not(.disable-slimscroll) >:first-child").slimscroll({height:$(t).data("scrollHeight")||"100%",size:$(t).data("scrollSize")||"4px",position:$(t).data("scrollPosition")||"right",color:$(t).data("scrollColor")||"rgba(0,0,0,0.6)",alwaysVisible:$(t).data("scrollAlwaysVisible")||!1,distance:$(t).data("scrollDistance")||"4px",railVisible:$(t).data("scrollRailVisible")||!1,railColor:$(t).data("scrollRailColor")||"#fafafa",allowPageScroll:!1,disableFadeOut:!1})}),(function(t){})),this.$on("submit",(function(){var a=t.validate(t.formData);if(a){var e=[].concat.apply([],t.formData.map((function(t){return t.components}))),s=e.map((function(t){return{name:t.key,value:t.value}})),i={};e.forEach((function(t){i[t.key]=t.value}));var r={data:i,fields:JSON.parse(JSON.stringify(t.formData))};s.push({name:t.task.formKey,value:JSON.stringify(r)}),l["a"].requestBpmn("runtime/tasks/"+t.task.id,"POST",{action:"complete",variables:s}).then((function(a){t.$parent.$emit("message",{type:"success",title:"提交成功",message:"任务提交成功。"}),t.$router.push({name:"tasks"})}),(function(a){t.$parent.$emit("message",{type:"error",title:"提交失败",message:"任务提交失败。"})}))}}))},mounted:function(){},methods:{validate:function(t){var a=!0;return t.forEach((function(t){var e=!0,s=t.components;s.forEach((function(t){var s=$.isArray(t.value)?t.value.length>0:!!t.value;t.invalid=t.validate.required&&!s,t.invalid&&(a=!1,e=!1)})),t.complete=e})),a||this.$parent.$emit("message",{type:"error",title:"填写表单",message:"表单信息填写不完整。"}),a},goStep:function(t,a){if(!(a<0||a>this.formData.length-1)){this.formData[t].components;var e=this.validate([this.formData[t]]);if(e){var s=$(".position-absolute .js-collapse");s.eq(t).collapse().hide(),s.eq(a).collapse().show()}}}},components:{Field:C}},_=x,w=Object(p["a"])(_,s,i,!1,null,"5afb1aa4",null);a["default"]=w.exports},"3ca3":function(t,a,e){"use strict";var s=e("6547").charAt,i=e("69f3"),r=e("7dd0"),l="String Iterator",n=i.set,o=i.getterFor(l);r(String,"String",(function(t){n(this,{type:l,string:String(t),index:0})}),(function(){var t,a=o(this),e=a.string,i=a.index;return i>=e.length?{value:void 0,done:!0}:(t=s(e,i),a.index+=t.length,{value:t,done:!1})}))},"99af":function(t,a,e){"use strict";var s=e("23e7"),i=e("d039"),r=e("e8b5"),l=e("861d"),n=e("7b0b"),o=e("50c4"),d=e("8418"),c=e("65f0"),u=e("1dde"),f=e("b622"),m=e("2d00"),p=f("isConcatSpreadable"),v=9007199254740991,b="Maximum allowed index exceeded",h=m>=51||!i((function(){var t=[];return t[p]=!1,t.concat()[0]!==t})),g=u("concat"),y=function(t){if(!l(t))return!1;var a=t[p];return void 0!==a?!!a:r(t)},C=!h||!g;s({target:"Array",proto:!0,forced:C},{concat:function(t){var a,e,s,i,r,l=n(this),u=c(l,0),f=0;for(a=-1,s=arguments.length;a<s;a++)if(r=-1===a?l:arguments[a],y(r)){if(i=o(r.length),f+i>v)throw TypeError(b);for(e=0;e<i;e++,f++)e in r&&d(u,f,r[e])}else{if(f>=v)throw TypeError(b);d(u,f++,r)}return u.length=f,u}})},f523:function(t,a,e){"use strict";e("4de4"),e("7db0"),e("4160"),e("c975"),e("d81d"),e("b0c0"),e("d3b7"),e("3ca3"),e("498a"),e("159b"),e("ddb0");var s=e("a49b"),i=e("bc3a"),r=e.n(i),l=e("323e"),n=e.n(l);r.a.interceptors.request.use((function(t){return n.a.start(),t})),r.a.interceptors.response.use((function(t){return n.a.done(),t}),(function(t){return n.a.done(),Promise.reject(t.response)})),a["a"]={getUsers:function(t){var a=this,e=t.map((function(t){return a.requestBpmn("identity/users/"+t)}));return Promise.all(e)},getItem:function(t,a){var e,i=this,l=s["a"][t+"Url"];return r.a.get(l+a).then((function(t){e=t;var a=e.data,s=[];return a.createdBy&&s.indexOf(a.createdBy)<0&&s.push(a.createdBy),a.updatedBy&&s.indexOf(a.updatedBy)<0&&s.push(a.updatedBy),i.getUsers(s)})).then((function(t){var a=e.data,s=t.map((function(t){return t.data}));if(a.createdBy){var i=s.find((function(t){return t.id.toLowerCase()===a.createdBy.toLowerCase()}));a.createdName=(i.firstName+" "+i.lastName).trim()}return a.updatedBy&&(i=s.find((function(t){return t.id.toLowerCase()===a.updatedBy.toLowerCase()})),a.updatedName=(i.firstName+" "+i.lastName).trim()),Promise.resolve(e)}))},getItems:function(t,a){var e=this,i=s["a"][t+"Url"];return new Promise((function(s,l){a=a||{},a.filter=a.filter||{},a.filter.type=t,a.filter=JSON.stringify(a.filter),a.sort&&(a.sort=JSON.stringify(a.sort));var n={dataType:"json",url:i,method:"get",params:a},o=[];return r()(n).then((function(t){o=t.data._embedded;var a=[];return o.forEach((function(t){t.createdBy&&a.indexOf(t.createdBy)<0&&a.push(t.createdBy),t.updatedBy&&a.indexOf(t.updatedBy)<0&&a.push(t.updatedBy)})),e.getUsers(a)})).then((function(t){o.forEach((function(a){var e=t.map((function(t){return t.data}));if(a.createdBy){var s=e.find((function(t){return t.id.toLowerCase()===a.createdBy.toLowerCase()}));a.createdName=(s.firstName+" "+s.lastName).trim()}a.updatedBy&&(s=e.find((function(t){return t.id.toLowerCase()===a.updatedBy.toLowerCase()})),a.updatedName=(s.firstName+" "+s.lastName).trim())})),s(o)}))}))},saveItem:function(t,a){return this.getItems(t,{filter:{name:a.name,_id:{$ne:a._id}}}).then((function(e){return e&&e.length?Promise.reject({message:'名称"'+a.name+'"已存在。'}):r()({dataType:"json",url:s["a"][t+"Url"],headers:{"Content-Type":"application/json"},method:"post",data:a})}))},deleteItem:function(t,a){var e=s["a"][t+"Url"];e+=a;var i={dataType:"text",url:e,method:"delete",data:{}};return r()(i)},requestBpmn:function(t,a,e){a=a||"GET";var i=s["a"].bpmnUrl+(t||""),l={dataType:"json",url:i,headers:{Authorization:sessionStorage.getItem("token"),"Content-Type":"application/json"},method:a};return"GET"===a?l.params=e:l.data=e,r()(l)},upload:function(t){return r()({method:"post",url:s["a"].uploadUrl+"upload",data:t,headers:{"Content-Type":"multipart/form-data"}})},getProcessTemplate:function(t){return r()({method:"get",url:"template/"+t+".bpmn",headers:{"Content-Type":"text"}})}}}}]);
//# sourceMappingURL=chunk-780cbbec.e8d9045f.js.map