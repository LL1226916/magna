(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-58e1bacb"],{"3ca3":function(t,e,a){"use strict";var s=a("6547").charAt,r=a("69f3"),i=a("7dd0"),n="String Iterator",o=r.set,l=r.getterFor(n);i(String,"String",(function(t){o(this,{type:n,string:String(t),index:0})}),(function(){var t,e=l(this),a=e.string,r=e.index;return r>=a.length?{value:void 0,done:!0}:(t=s(a,r),e.index+=t.length,{value:t,done:!1})}))},5712:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"row"},[a("div",{staticClass:"col-lg-12 col-xl-12 col-md-12"},[a("div",{staticClass:"panel",attrs:{id:"panel-1"}},[a("div",{staticClass:"panel-hdr"},[a("h2",[t._v("表单属性")]),a("div",{staticClass:"panel-toolbar",staticStyle:{"padding-right":"1em"}},[a("a",{directives:[{name:"show",rawName:"v-show",value:t.form._id,expression:"form._id"}],staticClass:"waves-effect waves-themed text-danger",staticStyle:{"margin-right":"24px"},attrs:{href:"javascript:void(0);","data-toggle":"modal","data-target":"#deleteModal"}},[a("i",{staticClass:"fal fa-fw fa-trash-alt mr-2"}),t._v("删除 ")]),a("a",{staticClass:"waves-effect waves-themed",staticStyle:{"margin-right":"24px"},attrs:{href:"javascript:void(0);"},on:{click:t.saveForm}},[a("i",{staticClass:"fal fa-fw fa-save mr-1"}),t._v("保存 ")]),t._m(0),t._m(1)]),a("div",{staticClass:"modal fade",attrs:{id:"deleteModal",tabindex:"-1",role:"dialog","aria-labelledby":"deleteModalTitle","aria-hidden":"true"}},[a("div",{staticClass:"modal-dialog modal-dialog-centered",attrs:{role:"document"}},[a("div",{staticClass:"modal-content"},[t._m(2),a("div",{staticClass:"modal-body"},[t._v("是否删除当前记录？ 请注意，此操作不可逆。")]),a("div",{staticClass:"modal-footer"},[a("button",{staticClass:"btn btn-secondary",attrs:{type:"button","data-dismiss":"modal"}},[t._v("取消")]),a("button",{staticClass:"btn btn-warning",attrs:{type:"button"},on:{click:function(e){return t.deleteForm()}}},[a("i",{staticClass:"fal fa-fw fa-trash-alt mr-2"}),t._v("删除 ")])])])])])]),a("div",{staticClass:"panel-container show"},[a("div",{staticClass:"panel-content"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-3 mt-2"},[a("div",{staticClass:"form-group"},[t._m(3),a("input",{directives:[{name:"model",rawName:"v-model",value:t.form.name,expression:"form.name"}],staticClass:"form-control form-control-sm",class:{"is-invalid":t.invalidName},attrs:{type:"text",id:"formName",required:""},domProps:{value:t.form.name},on:{input:function(e){e.target.composing||t.$set(t.form,"name",e.target.value)}}})])]),a("div",{directives:[{name:"show",rawName:"v-show",value:t.form._id&&t.form.createdAt,expression:"form._id && form.createdAt"}],staticClass:"col-3 mt-2"},[a("label",{staticClass:"form-label fw-300"},[a("i",{staticClass:"fal fa-fw fa-calendar-day mr-2"}),a("span",[t._v(t._s(t.moment(Number(t.form.createdAt)).format("YYYY-MM-DD HH:mm")))])]),t._v(" "),a("label",{directives:[{name:"show",rawName:"v-show",value:t.form._id,expression:"form._id"}],staticClass:"form-label fw-300",attrs:{for:"simpleinput"}},[a("i",{staticClass:"fal fa-fw fa-user-circle mr-2"}),a("span",[t._v(t._s(t.form.createdName))])])]),a("div",{directives:[{name:"show",rawName:"v-show",value:t.form._id&&t.form.updatedAt,expression:"form._id && form.updatedAt"}],staticClass:"col-3 mt-2"},[a("label",{staticClass:"form-label fw-300"},[a("i",{staticClass:"fal fa-fw fa-calendar-day mr-2"}),a("span",[t._v(t._s(t.moment(Number(t.form.updatedAt)).format("YYYY-MM-DD HH:mm")))])]),t._v(" "),a("label",{staticClass:"form-label fw-300"},[a("i",{staticClass:"fal fa-fw fa-user-circle mr-2"}),a("span",[t._v(t._s(t.form.updatedName))])])])])])])])]),t._m(4)])},r=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("button",{staticClass:"btn btn-panel bg-transparent fs-xl w-auto h-auto rounded-0 waves-effect waves-themed",attrs:{"data-action":"panel-collapse","data-toggle":"tooltip","data-offset":"0,10","data-original-title":"Collapse"}},[a("i",{staticClass:"fal fa-fw fa-minus"})])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("button",{staticClass:"btn btn-panel bg-transparent fs-xl w-auto h-auto rounded-0 waves-effect waves-themed",attrs:{"data-action":"panel-fullscreen","data-toggle":"tooltip","data-offset":"0,10","data-original-title":"Fullscreen"}},[a("i",{staticClass:"fal fa-fw fa-expand"})])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"modal-header"},[a("h5",{staticClass:"modal-title",attrs:{id:"deleteModalTitle"}},[t._v("删除记录")]),a("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[a("span",{attrs:{"aria-hidden":"true"}},[t._v("×")])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("label",{staticClass:"form-label",attrs:{for:"formName"}},[t._v(" 名称 "),a("i",{staticClass:"fal fa-fw fa-asterisk text-danger ml-2"})])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"col-lg-12 col-xl-12 col-md-12"},[a("div",{staticClass:"panel",attrs:{id:"panel-preview"}},[a("div",{staticClass:"panel-hdr"},[a("h2",[t._v("拖拽编辑")]),a("div",{staticClass:"panel-toolbar"},[a("button",{staticClass:"btn btn-panel bg-transparent fs-xl w-auto h-auto rounded-0 waves-effect waves-themed",attrs:{"data-action":"panel-collapse","data-toggle":"tooltip","data-offset":"0,10","data-original-title":"Collapse"}},[a("i",{staticClass:"fal fa-fw fa-minus"})]),a("button",{staticClass:"btn btn-panel bg-transparent fs-xl w-auto h-auto rounded-0 waves-effect waves-themed",attrs:{"data-action":"panel-fullscreen","data-toggle":"tooltip","data-offset":"0,10","data-original-title":"Fullscreen"}},[a("i",{staticClass:"fal fa-fw fa-expand"})])])]),a("div",{staticClass:"panel-container show"},[a("div",{staticClass:"panel-content"},[a("div",{staticClass:"row"},[a("div",{staticClass:"col-lg-12 col-xl-12 col-md-12",attrs:{id:"builder"}})])])])])])}],i=(a("b0c0"),a("d3b7"),a("a49b")),n=a("90b9"),o=a("f523"),l=a("f817"),d={data:function(){return n["a"].createModel({forms:[],form:{},moment:l["a"],config:i["a"],invalidName:!1})},created:function(){},mounted:function(){var t=this;Formio.builder(document.getElementById("builder"),{language:"ch",i18n:i["a"].i18n},{noDefaultSubmitButton:!0,language:"ch",i18n:i["a"].i18n}).then((function(e){t.builder=e,t.refresh()}))},methods:{refresh:function(){var t=this,e=this.$route.query&&this.$route.query.id;return this.form._id=e,this.invalidName=!1,new Promise((function(t,a){e?o["a"].getItem("form",e).then((function(e){t(e.data)})):t({})})).then((function(e){t.form=e;var a=t.form.formData||[];t.builder.webform.setForm({components:a})}))},deleteForm:function(){var t=this;this.form._id&&o["a"].deleteItem("form",this.form._id).then((function(e){$("#deleteModal").modal("hide"),t.$router.push({name:"forms"})}))},saveForm:function(){var t=this;if(this.invalidName=!1,this.form.name){var e=JSON.parse(JSON.stringify(this.form));delete e._etag,e.formData=this.builder.form.components;var a=Object(l["a"])().format("x");e._id?(e.updatedBy=this.user.id,e.updatedAt=a):(e.type="form",e.createdBy=this.user.id,e.createdAt=a,e._id=a);var s=e._id;delete e.createdName,delete e.updatedName,o["a"].saveItem("form",e).then((function(e){t.form._id||t.$router.push({name:"formEdit",query:{id:s}}),t.$parent.$emit("message",{type:"success",title:"保存表单",message:"保存成功。"}),t.refresh()}),(function(e){t.invalidName=!0,t.$parent.$emit("message",{type:"error",title:"保存流程",message:e.message})}))}else this.invalidName=!0}}},c=d,f=a("2877"),m=Object(f["a"])(c,s,r,!1,null,"adf3b420",null);e["default"]=m.exports},f523:function(t,e,a){"use strict";a("4de4"),a("7db0"),a("4160"),a("c975"),a("d81d"),a("b0c0"),a("d3b7"),a("3ca3"),a("498a"),a("159b"),a("ddb0");var s=a("a49b"),r=a("bc3a"),i=a.n(r),n=a("323e"),o=a.n(n);i.a.interceptors.request.use((function(t){return o.a.start(),t})),i.a.interceptors.response.use((function(t){return o.a.done(),t}),(function(t){return o.a.done(),Promise.reject(t.response)})),e["a"]={getUsers:function(t){var e=this,a=t.map((function(t){return e.requestBpmn("identity/users/"+t)}));return Promise.all(a)},getItem:function(t,e){var a,r=this,n=s["a"][t+"Url"];return i.a.get(n+e).then((function(t){a=t;var e=a.data,s=[];return e.createdBy&&s.indexOf(e.createdBy)<0&&s.push(e.createdBy),e.updatedBy&&s.indexOf(e.updatedBy)<0&&s.push(e.updatedBy),r.getUsers(s)})).then((function(t){var e=a.data,s=t.map((function(t){return t.data}));if(e.createdBy){var r=s.find((function(t){return t.id.toLowerCase()===e.createdBy.toLowerCase()}));e.createdName=(r.firstName+" "+r.lastName).trim()}return e.updatedBy&&(r=s.find((function(t){return t.id.toLowerCase()===e.updatedBy.toLowerCase()})),e.updatedName=(r.firstName+" "+r.lastName).trim()),Promise.resolve(a)}))},getItems:function(t,e){var a=this,r=s["a"][t+"Url"];return new Promise((function(s,n){e=e||{},e.filter=e.filter||{},e.filter.type=t,e.filter=JSON.stringify(e.filter),e.sort&&(e.sort=JSON.stringify(e.sort));var o={dataType:"json",url:r,method:"get",params:e},l=[];return i()(o).then((function(t){l=t.data._embedded;var e=[];return l.forEach((function(t){t.createdBy&&e.indexOf(t.createdBy)<0&&e.push(t.createdBy),t.updatedBy&&e.indexOf(t.updatedBy)<0&&e.push(t.updatedBy)})),a.getUsers(e)})).then((function(t){l.forEach((function(e){var a=t.map((function(t){return t.data}));if(e.createdBy){var s=a.find((function(t){return t.id.toLowerCase()===e.createdBy.toLowerCase()}));e.createdName=(s.firstName+" "+s.lastName).trim()}e.updatedBy&&(s=a.find((function(t){return t.id.toLowerCase()===e.updatedBy.toLowerCase()})),e.updatedName=(s.firstName+" "+s.lastName).trim())})),s(l)}))}))},saveItem:function(t,e){return this.getItems(t,{filter:{name:e.name,_id:{$ne:e._id}}}).then((function(a){return a&&a.length?Promise.reject({message:'名称"'+e.name+'"已存在。'}):i()({dataType:"json",url:s["a"][t+"Url"],headers:{"Content-Type":"application/json"},method:"post",data:e})}))},deleteItem:function(t,e){var a=s["a"][t+"Url"];a+=e;var r={dataType:"text",url:a,method:"delete",data:{}};return i()(r)},requestBpmn:function(t,e,a){e=e||"GET";var r=s["a"].bpmnUrl+(t||""),n={dataType:"json",url:r,headers:{Authorization:sessionStorage.getItem("token"),"Content-Type":"application/json"},method:e};return"GET"===e?n.params=a:n.data=a,i()(n)},upload:function(t){return i()({method:"post",url:s["a"].uploadUrl+"upload",data:t,headers:{"Content-Type":"multipart/form-data"}})},getProcessTemplate:function(t){return i()({method:"get",url:"template/"+t+".bpmn",headers:{"Content-Type":"text"}})}}}}]);
//# sourceMappingURL=chunk-58e1bacb.23ade3ba.js.map